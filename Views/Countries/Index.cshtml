@model IEnumerable<CountriesOftheWorld.Models.CountryInfo>
@{
    ViewBag.Title = "Index";
}

<div class="container">
    <div class="row header" style="text-align:center;color:green">
        <h2>All Countries</h2>
    </div>
    <table class="table table-striped table-bordered " style="width:100%" id="fulltable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Region</th>
                <th>Sub Region</th>
            </tr>
        </thead>
        <tbody>
        </tbody>

    </table>

    <table class="table table-striped table-bordered " style="width:100%; display: none" id="countryInfo">

        <thead>
            <tr>
                <th>Name</th>
                <th>Capital</th>
                <th>Population</th>
                <th>Currencies</th>
                <th>Languages</th>
                <th>Borders</th>
            </tr>
        </thead>

        <tbody>
        </tbody>

    </table>

    <table class="table table-striped table-bordered " style="width:100%; display: none" id="region">

        <thead>
            <tr>
                <th>Region Name</th>
                <th>Population</th>
                <th>Countries</th>
                <th>Subregion</th>
            </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <table class="table table-striped table-bordered " style="width:100%; display: none" id="subregion">

        <thead>
            <tr>
                <th>Subregion Name</th>
                <th>Population</th>
                <th>Region Name</th>
                <th>Countries</th>
            </tr>
        </thead>
        <tbody>


        </tbody>
    </table>
</div>

<link href="~/Scripts/DataTables-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet" />


@section scripts{
    <script src="~/Scripts/DataTables-1.12.1/js/jquery.dataTables.min.js"></script>
   
    <script>

        $(document).ready(function () {

            $("#fulltable").DataTable({
                "ajax": {
                    "url": "/Countries/GetCountries",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [

                    {
                        "data": "name",
                        "autoWidth": true,
                        "searchable": true,
                        "render": function (data, type, row, meta) {
                            return '<a href="#" id ="nametag">' + data + '</a>';
                        }
                    },
                    {
                        "data": "region",
                        "autoWidth": true,
                        "searchable": true,
                        "render": function (data, type, row, meta) {
                            return '<a href="#" id ="regiontag">' + data + '</a>';
                        }
                    },
                    {
                        "data": "subregion",
                        "autoWidth": true,
                        "searchable": true,
                        "render": function (data, type, row, meta) {
                            return '<a href="#" id ="subregion">' + data + '</a>';
                        }
                    },
                ],

                "order": [0, "asc"],
                "processing": "true",
                "language": {
                    "processing": "processing... please wait"
                }
            });

        });


        $('#fulltable').on('click', 'td', function () {
            var table = $('#fulltable').DataTable();
                var data = table.cell(this).data();
                console.log(data);
           
            console.log("I am here..." + data);

            $("#fulltable").hide();
            $("#countryInfo").show();           

            $("#countryInfo").DataTable({

                "ajax": {
                    "url": "/Countries/GetCountryInfo",
                    "type": "POST",
                    "data": { countryname: data },
                    "datatype": "json"
                },
                "columns": [

                    {
                        "data": "name",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "capital",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "population",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "currencies",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "languages",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "borders",
                        "autoWidth": true,
                        "searchable": true,
                        "render": function (data, type, row, meta) {
                            return '<a href="' + data + '">' + data + '</a>';
                        },
                    },
                ],

                "order": [0, "asc"],
                "processing": "true",
                "language": {
                    "processing": "processing... please wait"
                }
            });
          
            });

        $('td regiontag').on('click', 'td', function () {
            data = $('#fulltable').DataTable().cell(this).data();
            console.log(data);

            console.log("I am here..." + data);

            //$("#countryInfo").show();
            //$("#fulltable").hide();

            $("#countryInfo").DataTable({

                "ajax": {
                    "url": "/Countries/GetCountryInfo",
                    "type": "POST",
                    "data": { name: data },
                    "datatype": "json"
                },
                "columns": [

                    {
                        "data": "name",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "capital",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "population",
                        "autoWidth": true,
                        "searchable": true
                    },
                    ,
                    {
                        "data": "currencies",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "languages",
                        "autoWidth": true,
                        "searchable": true
                    },
                    {
                        "data": "borders",
                        "autoWidth": true,
                        "searchable": true,
                        "render": function (data, type, row, meta) {
                            return '<a href="' + data + '">' + data + '</a>';
                        },
                    },
                ],

                "order": [0, "asc"],
                "processing": "true",
                "language": {
                    "processing": "processing... please wait"
                }
            });
        });
    </script>


}